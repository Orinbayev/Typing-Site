{# typingapp/templates/contest/contest_detail.html #}
{% extends "base.html" %}
{% block title %}Musobaqa — {{ contest.title }}{% endblock %}

{% block content %}
<h3>{{ contest.title }}</h3>

<p class="text-muted">
  Vaqt: {{ contest.start_at|date:"Y-m-d H:i" }} — {{ contest.end_at|date:"Y-m-d H:i" }}
  &nbsp; | &nbsp; Entry fee: {{ contest.entry_fee }} {{ contest.currency|default:"UZS" }}
  &nbsp; | &nbsp; Konfig: {{ contest.language.name }} / {{ contest.level.name }} / {{ contest.duration.seconds }} s
</p>

{# ---- Asosiy holatlar ---- #}
{% if entry %}
  {# Foydalanuvchining arizasi mavjud #}

  {% if entry.status == 'APPROVED' %}
    {% if is_running %}
      <div class="alert alert-success">To‘lov tasdiqlandi. Boshlashing mumkin.</div>
      <a href="{% url 'typingapp:contest_start' contest.id %}" class="btn btn-primary">Boshlash</a>
    {% elif now < contest.start_at %}
      <div class="alert alert-info">
        To‘lov tasdiqlandi. Musobaqaning boshlanishini kuting:
        {{ contest.start_at|date:"Y-m-d H:i" }} – {{ contest.end_at|date:"Y-m-d H:i" }}.
      </div>
    {% else %}
      <div class="alert alert-secondary">Musobaqa vaqti tugagan.</div>
    {% endif %}

  {% elif entry.status == 'SUBMITTED' %}
    <div class="alert alert-info">Chek yuborilgan. Admin tekshirishi kutilmoqda.</div>

  {% elif entry.status == 'REJECTED' %}
    <div class="alert alert-danger">
      Chekingiz rad etilgan.
      {% if entry.review_message %} Sabab: {{ entry.review_message }}{% endif %}
    </div>
    {% if is_open_for_upload %}
      <a href="{% url 'typingapp:contest_join' contest.id %}" class="btn btn-outline-primary">
        Chekni qayta yuborish
      </a>
    {% endif %}

  {% else %}
    <div class="alert alert-secondary">Arizangiz holati: {{ entry.status }}.</div>
  {% endif %}

{% else %}
  {# Ariza yo‘q — hali ro‘yxatdan o‘tmagan #}
  {% if is_open_for_upload %}
    {% if is_running %}
      <div class="alert alert-info">Musobaqa davom etmoqda. Ishtirok uchun chek yuboring.</div>
    {% else %}
      <div class="alert alert-info">
        Ro‘yxatdan o‘tish ochiq. Boshlanishi: {{ contest.start_at|date:"Y-m-d H:i" }}.
      </div>
    {% endif %}
    <a href="{% url 'typingapp:contest_join' contest.id %}" class="btn btn-primary">Chek yuborish</a>
  {% else %}
    <div class="alert alert-secondary">Hozir ro‘yxatdan o‘tish yopiq.</div>
  {% endif %}
{% endif %}

<div class="mt-3">
  <a class="btn btn-outline-secondary" href="{% url 'typingapp:contest_leaderboard' contest.id %}">
    Premium reyting
  </a>
</div>
{% endblock %}
